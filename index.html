<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="UTF-8">
        <title>Project Covid-19</title>
        <link rel="stylesheet" href="styles/style.css">
        <link rel="stylesheet" href="styles/styleFooter.css">
        <link rel="stylesheet" href="styles/styleNavbar.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



    </head>
    <script>
        const API_URL = 'https://corona.lmao.ninja/v2/countries/thailand';
        async function getAPIdata() {
            const reson = await fetch(API_URL);
            const data = await reson.json();
            var new_case = String(thousands_separators(data.cases));
            var total_case_today = String(thousands_separators(data.todayCases));
            var total_death_today = String(thousands_separators(data.todayDeaths));
            var death = String(thousands_separators(data.deaths));
            document.getElementById('newcase').innerHTML = `Infected   &nbsp;${new_case}`;
            document.getElementById('newdeath').innerHTML = `Death  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${death}`;
            document.getElementById('total_case_today').innerHTML = `New   + ${total_case_today}`;
            document.getElementById('total_death_today').innerHTML = `Death   + ${total_death_today}`;
            
        }
        function thousands_separators(num){
            var num_parts = num.toString().split(".");
            num_parts[0] = num_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return num_parts.join(".");
        }

  


        getAPIdata();

    </script>
    <body>
        <section id = "headerWeb">
            <div class = "navbar" id = "topnav">
                <a class = "active" href = "#">Covid-19 Statistics</a>
                <a href="#">News</a>
                <a href="#">About</a>
                <a href="#">Contact</a>
            </div>
            <div>
                <button class="button button1">Button</button>
                <button class="button button2">Button</button>
                <button class="button button3">Button</button>
            </div>
        </section>
       <section id="bodyweb">
           <div class="stats">
                <div class="firstgrid">
                    <h1>Covid-19 Today in Thailand</h1>
                    <p>ข้อมูลเกี่ยวกับโรคติดเชื้อไวรัสโคโรนา 2019 (COVID-19) โดยกรมควบคุมโรค กระทรวงสาธารณสุข. </p>
                    <canvas id="myChart" width="200px" height="110px"></canvas>
                </div>
                <div class="secgrid">

                    <h1 id="total_case_today"></h1>
                    <h2 id="total_death_today" style="color: red;"></h2>
                    
                    <h1>Summary</h1>

                    <h2 id="newcase" ></h2>
                    <h2 id="newdeath" style="color: red;"></h2>

                </div>
                <div class="thirdgrid">
                    <div class="line" style="border: 1px solid black; width: 98%; align-items: center;"></div>
                    <h1 class="newstext">NEWS</h1>
                    <div class="newsFeed" "> 

                        <div class="news" style="width: 100%;">
                            <img src="images/covid-19-4960254_1280.png">
                            <p>ข้อมูลเกี่ยวกับโรคติดเชื้อไวรัสโคโรนา 2019 (COVID-19) โดยกรมควบคุมโรค .</p>
                            <button type="button">read more</button>
                        </div>

                        <div class="news" style="width: 100%;">
                            <img src="images/covid-19-4960254_1280.png">
                            <p>ข้อมูลเกี่ยวกับโรคติดเชื้อไวรัสโคโรนา 2019 (COVID-19) โดยกรมควบคุมโรค .</p>
                            <button type="button">read more</button>
                        </div>

                        <div class="news" style="width: 100%;">
                            <img src="images/covid-19-4960254_1280.png">
                            <p>ข้อมูลเกี่ยวกับโรคติดเชื้อไวรัสโคโรนา 2019 (COVID-19) โดยกรมควบคุมโรค</p>
                            <button type="button">read more</button>
                        </div>

                        

                    </div>

                </div>
                
            </div>
        </section>
        <section id="footerweb">
            <div class="footerLeft">
                <h1>Contact</h1>
                <p>Email example</p>
                <p>Facebook example</p>
                <p>Twitter example</p>
            </div>
            <div class="footerCenter">
                <p>Copyright © 2021 All Rights Reserved by Devoloper</p>
            </div>
            <div class="footerRight">
                <p>Thank You</p>
            </div>
        </section>

    </body>
    <script>

        const d = new Date();
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const monthsNum = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"];
        var total_case1;
        var total_case2;
        var total_case3;
        var total_case4;
        var total_case5;
        var total_case6;
        var toDayData = `${d.getFullYear()}-${monthsNum[d.getMonth()]}-01`;
        var toDay2Data  = `${d.getFullYear()}-${monthsNum[d.getMonth()-1]}-01`;;
        var toDay3Data  = `${d.getFullYear()}-${monthsNum[d.getMonth()-2]}-01`;;
        var toDay4Data = `${d.getFullYear()}-${monthsNum[d.getMonth()-3]}-01`;;
        var toDay5Data = `${d.getFullYear()}-${monthsNum[d.getMonth()-4]}-01`;;
        var toDay6Data = `${d.getFullYear()}-${monthsNum[d.getMonth()-5]}-01`;;
    
    
        const API_URL2 = 'https://covid19.ddc.moph.go.th/api/Cases/timeline-cases-all';
        async function getAPIdata2() {
            const reson2 = await fetch(API_URL2);
            const data2 = await reson2.json();
    
    
    
            // for (let i = 0; i < data2.length; i++) {
            //     if(data2[i][1] == `${d.getFullYear}-${d.getMonth}-01`){
            //         console.log(data2[i].txn_date)
            //     }
    
            // }
            var i = 0;
    
            while (true) {
                i+=1;
                if (data2[i].txn_date == toDayData) {
                    total_case1 = data2[i];
                    break;
                }
                if (data2[i].txn_date == toDay2Data) {
                    total_case2 = data2[i];
    
                }
                if (data2[i].txn_date == toDay3Data) {
                    total_case3 = data2[i];
    
                }
                if (data2[i].txn_date == toDay4Data) {
                    total_case4 = data2[i];
    
                }
                if (data2[i].txn_date == toDay5Data) {
                    total_case5 = data2[i];
    
                }
                if (data2[i].txn_date == toDay6Data) {
                    total_case6 = data2[i];
    
                }
            }
            var total6 = Number.parseFloat(total_case6.new_case)
            var total5 = Number.parseFloat(total_case5.new_case)
            var total4 = Number.parseFloat(total_case4.new_case)
            var total3 = Number.parseFloat(total_case3.new_case)
            var total2 = Number.parseFloat(total_case2.new_case)
            var total1 = Number.parseFloat(total_case1.new_case)
    
            var totalD6 = Number.parseFloat(total_case6.new_death)
            var totalD5 = Number.parseFloat(total_case5.new_death)
            var totalD4 = Number.parseFloat(total_case4.new_death)
            var totalD3 = Number.parseFloat(total_case3.new_death)
            var totalD2 = Number.parseFloat(total_case2.new_death)
            var totalD1 = Number.parseFloat(total_case1.new_death)
    
    
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [months[d.getDate() - 5] + " " + d.getFullYear(), months[d.getDate() - 4]+ " " + d.getFullYear(), months[d.getDate() - 3]+ " " + d.getFullYear(), months[d.getDate() - 2]+ " " + d.getFullYear(), months[d.getDate() - 1]+ " " + d.getFullYear(), months[d.getDate()]+ " " + d.getFullYear()],
                    datasets: [{
                        label: '# ติดเชื้อ',
                        data: [total6, total5, total4, total3, total2, total1],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    },
                    {
                        label: '# เสียชีวิต',
                        data: [totalD6, totalD5, totalD4, totalD3, totalD2, totalD1],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    
        getAPIdata2()
    
    
    </script>
</html>